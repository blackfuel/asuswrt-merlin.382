#!/bin/sh
#
# This shell script if placed in /etc/apcupsd
# will be called by /etc/apcupsd/apccontrol when apcupsd
# loses contact with the UPS (i.e. the serial connection is not responding).
# We send an email message to root to notify him.
#
. /usr/local/etc/apcupsd/apcupsd_mail.conf

MSG="$HOSTNAME Communications with UPS $1 lost"
#
(
   echo "From: $FROM"
   echo "To: $TO"
   echo "Subject: $MSG"
   echo " "
   echo "$MSG"
   echo " "
   /usr/sbin/apcaccess status
) | $MAILPROG -t -S $MAILHOST -f $(echo $FROM | sed -r 's/.*<(.*)>.*/\1/')
exit 0
